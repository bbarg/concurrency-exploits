#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

/**
 * hator-test.c
 * Copyright 2014 - Benjamin Barg
 * benbakerbarg@gmail.com
 * 
 * This program gives a few different ways to run the 'hator' bug in
 * close succession, for the purpose of testing system
 * destabilization. The first option is to 
 */
int main(int argc, char **argv)
{
  
  pid_t pid;
  int i, n, delay, status;

  if( argc != 3 )
    {
      fprintf(stderr, "usage: ./hator-test <number of repetitions> <delay between repetitions>\n");
      exit(1);
    }

  n = atoi(argv[1]);
  delay = atoi(argv[2]);

  for( i=0; i<n; i++ )
    {
      if( pid = fork() < 0 )
	{
	  perror("fork failed");
	  exit(1);
	}
      else if( pid == 0 ) // child
	{
	  execl("./hator", "hator", NULL);
	  perror("exec failed");
	  exit(1);
	}
      else // parent
	{

	}
    }
  
  waitpid(-1, &status, 0);
}
