# `do_brk(` bug on RedHat 8

## Install Redhat8

Go to ftp://archive.download.redhat.com/pub/redhat/linux/8.0/en/iso/i386/ and download all 5 iso images.

Create a "RedHat Linux" VMWare workstation with all default settings.

Select `psyche-i386-disc1.iso` for the install disk. Also check "Connected" for the CD/DVD drive type, as this allows swapping in the secondary install CDs.

Hit enter upon initial bootup to select the GUI install.

Skip the CD-ROM check.
Command sequence:
-> next
-> next
-> next
-> next
-> next (select "Workstation" installation type)
-> next (automatically partition)
-> next (Remove all Linux partitions on this system)
-> yes
-> next
-> next
-> next (default firewall rules)
-> next (no additional language support)
-> next (choose your time zone)
-> next (choose a simple root password and create a user account)
-> next (default packages, you can take some out if you want to make things go faster)
-> next (start the installation)

You may have to swap secondary install discs in during the installation. To do so, open up the VM's settings window and under "Hardware -> CD/DVD" change the file under "Use an ISO image".

Now the installation is done:
-> next (we don't need a boot disk)
-> next (generic GUI driver)
-> next (use "Unprobed Monitor" unless you want to take the time to customize)
-> next (default display settings)

System reboot.

Final configurations:
-> foward
-> forward (date and time should set just fine)
-> forward
-> forward (don't register system with Red Hat Network)
-> forward (don't need to install additional CDs)

## Run Exploit
Download `hatorihanzo.c` from sebug.net/paper/linux_exp/2.4.23/hatorihanzo.c.
Compile with `-static` option:
```bash
gcc -static hatorihanzo.c -o hator 
```
Run the executable. You should obtain root shell (with a prompt like `sh-2.05b#`). Try `touch /root/evil` to check if you actually have privileges. I ran it about 10 or so times in a row by hand and had it succeed every time. Interestingly, if you background `hator` with `./hator &` it blocks on the root shell exec call, which you can obtain by foregrounding it again (`fg`).

There's also a test program, "hator-test.c" that you can compile and run to try to reproduce some system instability. 
